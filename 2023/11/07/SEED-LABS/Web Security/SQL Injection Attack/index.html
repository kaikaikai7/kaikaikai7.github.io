

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="kaikaikai">
  <meta name="keywords" content="">
  
    <meta name="description" content="1. Overview SQL注入是一种代码注入技术，它利用web应用程序和数据库服务器之间接口中的漏洞。当用户的输入在发送到后端数据库服务器之前未在web应用程序中正确检查时，就会出现此漏洞。 许多web应用程序从用户处获取输入，然后使用这些输入构造SQL查询，这样web应用程序就可以从数据库中获取信息。Web应用程序还使用SQL查询在数据库中存储信息。这些是web应用程序开发中的常见做法。">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL Injection Attack">
<meta property="og:url" content="http://example.com/2023/11/07/SEED-LABS/Web%20Security/SQL%20Injection%20Attack/index.html">
<meta property="og:site_name" content="kaikaikai&#39;s blog">
<meta property="og:description" content="1. Overview SQL注入是一种代码注入技术，它利用web应用程序和数据库服务器之间接口中的漏洞。当用户的输入在发送到后端数据库服务器之前未在web应用程序中正确检查时，就会出现此漏洞。 许多web应用程序从用户处获取输入，然后使用这些输入构造SQL查询，这样web应用程序就可以从数据库中获取信息。Web应用程序还使用SQL查询在数据库中存储信息。这些是web应用程序开发中的常见做法。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-07T10:17:23.000Z">
<meta property="article:modified_time" content="2024-01-07T06:47:24.336Z">
<meta property="article:author" content="kaikaikai">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>SQL Injection Attack - kaikaikai&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="SQL Injection Attack"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-07 18:17" pubdate>
          2023年11月7日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          75 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">SQL Injection Attack</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="overview">1. Overview</h1>
<p>SQL注入是一种代码注入技术，它利用web应用程序和数据库服务器之间接口中的漏洞。当用户的输入在发送到后端数据库服务器之前未在web应用程序中正确检查时，就会出现此漏洞。</p>
<p>许多web应用程序从用户处获取输入，然后使用这些输入构造SQL查询，这样web应用程序就可以从数据库中获取信息。Web应用程序还使用SQL查询在数据库中存储信息。这些是web应用程序开发中的常见做法。如果未仔细构造SQL查询，则可能会出现SQL注入漏洞。SQL注入攻击是对web应用程序最常见的攻击之一。</p>
<p>在本实验室中，我们创建了一个易受SQL注入攻击的web应用程序。我们的web应用程序包含许多web开发人员所犯的常见错误。学生的目标是找到利用SQL注入漏洞的方法，演示攻击可能造成的损害，并掌握有助于抵御此类攻击的技术。本实验室涵盖以下主题：</p>
<ul>
<li>SQL 语句：SELECT 和 UPDATE 语句</li>
<li>SQL 注入</li>
<li>准备语句</li>
</ul>
<h1 id="lab-environment">2. Lab Environment</h1>
<p>我们为本实验室开发了一个网络应用程序，并使用容器来设置该网络应用程序。
实验室设置中有两个容器，一个用于托管网络应用程序，另一个用于托管网络应用程序的数据库。网络应用程序容器的
IP 地址是 10.9.0.5，网络应用程序的 URL 如下：</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514684.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144330850" />
<figcaption aria-hidden="true">image-20231211144330850</figcaption>
</figure>
<p>我们需要将此主机名映射到容器的 IP 地址。请在 /etc/hosts
文件中添加以下条目。您需要使用 root 权限来更改此文件（使用
sudo）。需要注意的是，这个名称可能已经因为其他实验室的原因被添加到文件中。如果映射到不同的
IP 地址，则必须删除旧条目。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514685.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144357379" />
<figcaption aria-hidden="true">image-20231211144357379</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810535.png" srcset="/img/loading.gif" lazyload
alt="image-20231107170405811" />
<figcaption aria-hidden="true">image-20231107170405811</figcaption>
</figure>
<h2 id="container-setup-and-commands">2.1 Container Setup and
Commands</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dcbuild <span class="hljs-comment"># Alias for: docker-compose build</span><br>$ dcup <span class="hljs-comment"># Alias for: docker-compose up</span><br>$ dcdown <span class="hljs-comment"># Alias for: docker-compose down</span><br><br>$ dockps // Alias <span class="hljs-keyword">for</span>: docker ps --format <span class="hljs-string">&quot;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125;&quot;</span><br>$ docksh &lt;<span class="hljs-built_in">id</span>&gt; // Alias <span class="hljs-keyword">for</span>: docker <span class="hljs-built_in">exec</span> -it &lt;<span class="hljs-built_in">id</span>&gt; /bin/bash<br></code></pre></td></tr></table></figure>
<p><strong>MySQL
数据库</strong>：容器通常是一次性的，因此一旦被销毁，容器内的所有数据都会丢失。在本实验室中，我们确实希望保留
MySQL
数据库中的数据，这样在关闭容器时就不会丢失我们的工作。为此，我们将主机上的
mysql 数据文件夹（在 Labsetup 中，它将在 MySQL
容器运行一次后创建）挂载到 MySQL 容器内的 /var/lib/mysql
文件夹。该文件夹是 MySQL
存储数据库的地方。因此，即使容器被破坏，数据库中的数据仍会保留。如果确实想从一个干净的数据库开始，可以删除此文件夹：</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514686.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144536327" />
<figcaption aria-hidden="true">image-20231211144536327</figcaption>
</figure>
<h2 id="about-the-web-application">2.2 About the Web Application</h2>
<p>我们创建了一个网络应用程序，这是一个简单的员工管理应用程序。员工可以通过这个网络应用程序查看和更新数据库中的个人信息。在这个网络应用程序中主要有两个角色：管理员是特权角色，可以管理每个员工的个人资料信息；员工是普通角色，可以查看或更新自己的个人资料信息。所有员工信息如表
1 所示。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514687.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144609062" />
<figcaption aria-hidden="true">image-20231211144609062</figcaption>
</figure>
<h1 id="lab-tasks">3. Lab Tasks</h1>
<h2 id="task-1-get-familiar-with-sql-statements">3.1 Task 1: Get
Familiar with SQL Statements</h2>
<p>本任务的目的是通过使用所提供的数据库来熟悉 SQL
命令。我们的网络应用程序使用的数据存储在 MySQL
数据库中，该数据库托管在我们的 MySQL 容器上。 我们创建了一个名为 sqllab
users 的数据库，其中包含一个名为 credential
的表。该表存储了每位员工的个人信息（如
eid、密码、工资、社保号等）。在本任务中，您需要使用数据库来熟悉 SQL
查询。</p>
<p>请在 MySQL 容器上获取一个
shell（有关说明，请参阅容器手册；手册链接到实验室网站）。然后使用 mysql
客户端程序与数据库交互。用户名为 root，密码为 dees。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514689.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144748267" />
<figcaption aria-hidden="true">image-20231211144748267</figcaption>
</figure>
<p>登录后，您可以创建新数据库或加载现有数据库。由于我们已经为您创建了
sqllab 用户数据库，您只需使用 use 命令加载现有数据库即可。要显示 sqllab
用户数据库中有哪些表，可以使用 show tables
命令打印出所选数据库中的所有表。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514690.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144807806" />
<figcaption aria-hidden="true">image-20231211144807806</figcaption>
</figure>
<p>运行上述命令后，您需要使用 SQL 命令打印雇员 Alice
的所有档案信息。请提供结果截图。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li><p><code>dockps</code>查看正在运行的容器，找到mysql容器的ID；</p></li>
<li><p><code>docksh ID</code>进入容器的shell；</p></li>
<li><p><code>mysql -u root -pdees</code>登录进入mysql交互界面；</p></li>
<li><p><code>show databases;</code>查看数据库；</p></li>
<li><p><code>use sqllab_users;</code>选择进入已创建的数据库；</p></li>
<li><p><code>show tables;</code>查看表；</p></li>
<li><p><code>select * from credential where Name='Alice';</code>打印Alice的所有信息</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514691.png" srcset="/img/loading.gif" lazyload
alt="image-20231211144910503" />
<figcaption aria-hidden="true">image-20231211144910503</figcaption>
</figure></li>
</ol>
<h2 id="task-2-sql-injection-attack-on-select-statement">3.2 Task 2: SQL
Injection Attack on SELECT Statement</h2>
<p>SQL 注入基本上是一种技术，攻击者可以通过它执行自己的恶意 SQL
语句，一般称为恶意有效载荷。通过恶意 SQL
语句，攻击者可以从受害者数据库中窃取信息；更有甚者，他们还可能对数据库进行更改。我们的员工管理网络应用程序存在
SQL 注入漏洞，这些漏洞模仿了开发人员经常犯的错误。</p>
<p>我们将使用 www.seed-server.com
中的登录页面来完成这项任务。登录页面如图 1
所示。它要求用户提供用户名和密码。网络应用程序根据这两个数据对用户进行身份验证，因此只有知道密码的员工才能登录。作为攻击者，你的任务就是在不知道任何员工凭证的情况下登录网络应用程序。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514692.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145039960" />
<figcaption aria-hidden="true">image-20231211145039960</figcaption>
</figure>
<p>为了帮助您开始这项任务，我们将解释如何在网络应用程序中实施身份验证。
位于 /var/www/SQL_Injection 目录中的不安全 home.php PHP
代码用于进行用户身份验证。下面的代码片段展示了如何对用户进行身份验证。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514693.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145106237" />
<figcaption aria-hidden="true">image-20231211145106237</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514694.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145112539" />
<figcaption aria-hidden="true">image-20231211145112539</figcaption>
</figure>
<p>上述 SQL 语句从凭证表中选择员工个人信息，如
ID、姓名、工资、社保号等。SQL 语句使用两个变量 input uname 和 hashed
pwd，其中 input uname 保存用户在登录页面的用户名字段中输入的字符串，而
hashed pwd 保存用户输入的密码的 sha1
哈希值。程序会检查是否有记录与所提供的用户名和密码匹配；如果匹配，则用户身份验证成功，并获得相应的员工信息。如果不匹配，则验证失败。</p>
<h3 id="task-2.1-sql-injection-attack-from-webpage">3.2.1 Task 2.1: SQL
Injection Attack from webpage</h3>
<p>您的任务是以管理员身份从登录页面登录网络应用程序，以便查看所有员工的信息。我们假设您知道管理员的账户名是
admin，但不知道密码。您需要决定在用户名和密码字段中输入什么内容才能成功攻击。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li><p>注入语句：username:<code>admin’--(空格)</code>或<code>admin’#</code>；password:任意值，可为空。</p></li>
<li><p>注入原理：字符型注入，通过单引号进行闭合.<code>--(空格)</code>和<code>#</code>在SQL查询语句中都表示注释，因此后面的SQL语句不会执行.根据伪代码，用户名为admin，查询得到全部用户信息.</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514695.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145253840" />
<figcaption aria-hidden="true">image-20231211145253840</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514696.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145306602" />
<figcaption aria-hidden="true">image-20231211145306602</figcaption>
</figure></li>
</ol>
<h3 id="task-2.2-sql-injection-attack-from-command-line.">3.2.2 Task
2.2: SQL Injection Attack from command line.</h3>
<p>您的任务是重复任务
2.1，但需要在不使用网页的情况下完成。你可以使用命令行工具，例如可以发送
HTTP 请求的 curl。值得一提的是，如果你想在 HTTP
请求中包含多个参数，就需要将 URL
和参数放在一对单引号之间；否则，用于分隔参数的特殊字符（如 &amp;）会被
shell
程序解释，从而改变命令的含义。下面的示例展示了如何向网络应用程序发送
HTTP GET 请求，并附加两个参数（用户名和密码）：</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514697.png" srcset="/img/loading.gif" lazyload
alt="image-20231211145340087" />
<figcaption aria-hidden="true">image-20231211145340087</figcaption>
</figure>
<p>如果需要在用户名或密码字段中包含特殊字符，则需要正确编码，否则会改变请求的含义。如果要在这些字段中包含单引号，应使用
%27 代替；如果要包含空白，应使用 %20。在本任务中，你确实需要在使用 curl
发送请求时处理 HTTP 编码。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li>注入原理：同task2.1相同，只需要对特殊字符进行URL编码即可。%27是单引号的url编码，%20是空格的url编码，%23是#的url编码。</li>
<li>注入命令1（使用--
进行注释）：<code>curl 'www.seed-server.com/unsafe_home.php?username=admin%27--%20&amp;Password='</code>；注入命令2（使用#进行注释）：<code>curl 'www.seed-server.com/unsafe_home.php?username=admin%27%23&amp;Password='</code>。</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810540.png" srcset="/img/loading.gif" lazyload
alt="image-20231107171906043" />
<figcaption aria-hidden="true">image-20231107171906043</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810541.png" srcset="/img/loading.gif" lazyload
alt="image-20231107171913097" />
<figcaption aria-hidden="true">image-20231107171913097</figcaption>
</figure>
<h3 id="task-2.3append-a-new-sql-statement">3.2.3 Task 2.3:Append a new
SQL statement</h3>
<p>在上述两种攻击中，我们只能窃取数据库中的信息；如果我们能利用登录页面中的相同漏洞修改数据库，效果会更好。
一种方法是使用 SQL 注入攻击，将一条 SQL
语句变成两条，第二条是更新或删除语句。在 SQL 中，分号（;）用于分隔两条
SQL 语句。请尝试通过登录页面运行两条 SQL 语句。</p>
<p>在这次攻击中，有一种对策可以阻止你运行两条 SQL 语句。请使用 SEED
书籍或互联网资源找出这个对策，并在实验报告中描述你的发现。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li>注入语句：username：<code>admin';UPDATE credential  SET Salary = '66666' WHERE Name='Alice';#</code>；password：任意值。</li>
<li>执行效果：注入失败，返回报错信息。</li>
<li>原因分析：使用mysqli对象中的query()方法每次调用只能执行一条SQL命令。如果需要一次执行多条SQL命令，就必须使用mysqli对象中的
multi_query()方法。具体做法是把多条SQL命令写在同一个字符串里作为参数传递给multi_query()方法，多条SQL之间使用分号
（;）分隔。通过代码审计，发现后端使用了query()方法，因此执行多条SQL语句会报错。</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514698.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150008947" />
<figcaption aria-hidden="true">image-20231211150008947</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514699.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150020434" />
<figcaption aria-hidden="true">image-20231211150020434</figcaption>
</figure>
<h2 id="task-3-sql-injection-attack-on-update-statement">3.3 Task 3: SQL
Injection Attack on UPDATE Statement</h2>
<p>如果在 UPDATE 语句中出现 SQL
注入漏洞，危害将更加严重，因为攻击者可以利用该漏洞修改数据库。在我们的
"员工管理 "应用程序中，有一个 "编辑个人资料 "页面（图
2）允许员工更新个人资料信息，包括昵称、电子邮件、地址、电话号码和密码。要进入该页面，员工需要先登录。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514700.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150126409" />
<figcaption aria-hidden="true">image-20231211150126409</figcaption>
</figure>
<p>当员工通过编辑个人资料页面更新信息时，将执行以下 SQL UPDATE
查询。在不安全的 edit backend.php 文件中执行的 PHP
代码用于更新员工的个人资料信息。该 PHP 文件位于 /var/www/SQLInjection
目录中。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514701.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150135082" />
<figcaption aria-hidden="true">image-20231211150135082</figcaption>
</figure>
<h3 id="task-3.1-modify-your-own-salary">3.3.1 Task 3.1: Modify your own
salary</h3>
<p>如编辑个人资料页面所示，员工只能更新自己的昵称、电子邮件、地址、电话号码和密码，无权更改工资。假设您（Alice）是一名心怀不满的员工，而您的老板
Boby 今年没有给您涨工资。你想利用编辑-档案页面中的 SQL
注入漏洞来增加自己的工资。请演示如何实现这一目标。我们假设你知道工资存储在名为
salary 的列中。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li>注入语句：<code>1',Salary='666666</code>.</li>
<li>注入原理：利用SQL语句对用户输入直接进行拼接的漏洞，添加了一个字段和对应值.成功修改个人工资.</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810544.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172301359" />
<figcaption aria-hidden="true">image-20231107172301359</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810545.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172315590" />
<figcaption aria-hidden="true">image-20231107172315590</figcaption>
</figure>
<h3 id="task-3.2modify-other-people-salary">3.3.2 Task 3.2:Modify other
people’ salary</h3>
<p>在增加了自己的工资后，您决定惩罚您的老板 Boby。你想把他的工资降到 1
美元。请演示如何实现这一目标。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li>注入语句：<code>',salary='1' where name='Boby'#</code>.</li>
<li>注入原理：SQL更新语句是根据where后面的值进行查找更新，可以将name值设置为Boby，即可修改Boby信息.查看所有人信息，成功修改Boby工资.</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810546.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172506189" />
<figcaption aria-hidden="true">image-20231107172506189</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810547.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172511134" />
<figcaption aria-hidden="true">image-20231107172511134</figcaption>
</figure>
<h3 id="task-3.3modify-other-people-password">3.3.3 Task 3.3:Modify
other people’ password</h3>
<p>在修改了 Boby 的工资后，你仍然心怀不满，因此你想把 Boby
的密码改成你知道的密码，然后你就可以登录他的账户，进一步进行破坏。请演示你是如何做到这一点的。你需要证明你可以使用新密码成功登录
Boby
的账户。这里值得一提的是，数据库存储的是密码的哈希值，而不是明文密码字符串。你可以再次查看不安全的编辑
backend.php 代码，了解密码是如何存储的。它使用 SHA1
散列函数生成密码的散列值。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li>注入语句：<code>',password='修改密码SHA1值' where name='Boby'#</code>。</li>
<li>注意：因为数据库中存储了密码SHA1值，因为我们直接修改密码时需要先进行SHA1转换。成功以修改后的密码登录boby账号。</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810548.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172621254" />
<figcaption aria-hidden="true">image-20231107172621254</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810549.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172605030" />
<figcaption aria-hidden="true">image-20231107172605030</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810550.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172610471" />
<figcaption aria-hidden="true">image-20231107172610471</figcaption>
</figure>
<h2 id="task-4-countermeasure-prepared-statement">3.4 Task 4:
Countermeasure — Prepared Statement</h2>
<p>SQL 注入漏洞的根本问题在于未能将代码与数据分开。在编写 SQL
语句时，程序（如 PHP
程序）知道哪一部分是数据，哪一部分是代码。不幸的是，当 SQL
语句发送到数据库时，边界已经消失；SQL
解释器看到的边界可能与开发人员设置的原始边界不同。要解决这个问题，必须确保服务器端代码和数据库中的边界视图保持一致。最安全的方法是使用准备语句。</p>
<p>要了解准备语句如何防止 SQL 注入，我们需要了解 SQL
服务器接收查询时会发生什么。执行查询的高级工作流程如图 3
所示。在编译步骤中，查询首先要经过解析和规范化阶段，即根据语法和语义检查查询。下一个阶段是编译阶段，在这一阶段，关键字（如
SELECT、FROM、UPDATE
等）被转换成机器可以理解的格式。基本上，在这一阶段，查询会被解释。在查询优化阶段，会考虑执行查询的不同计划数量，并从中选择最佳优化计划。所选计划存储在缓存中，因此每当有下一个查询进来时，就会根据缓存中的内容进行检查；如果缓存中已经存在内容，就会跳过解析、编译和查询优化阶段。然后，编译后的查询将被传递到执行阶段，并在该阶段实际执行。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514702.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150736534" />
<figcaption aria-hidden="true">image-20231211150736534</figcaption>
</figure>
<p>准备语句出现在编译之后，执行之前。预编译语句将经过编译步骤，并变成一个预编译查询，其中的数据占位符为空。要运行这个预编译查询，需要提供数据，但这些数据不会经过编译步骤，而是直接插入预编译查询，然后发送到执行引擎。因此，即使数据中包含
SQL
代码，在不经过编译步骤的情况下，代码也会被简单地视为数据的一部分，没有任何特殊含义。这就是准备语句防止
SQL 注入攻击的方法。</p>
<p>下面是一个如何在 PHP 中编写准备语句的示例。在下面的示例中，我们使用了
SELECT 语句。我们展示了如何使用准备语句重写易受 SQL 注入攻击的代码。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514703.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150841695" />
<figcaption aria-hidden="true">image-20231211150841695</figcaption>
</figure>
<p>上述代码容易受到 SQL 注入攻击。可将其重写如下：</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514704.png" srcset="/img/loading.gif" lazyload
alt="image-20231211150940003" />
<figcaption aria-hidden="true">image-20231211150940003</figcaption>
</figure>
<p>利用预处理语句机制，我们将向数据库发送 SQL
语句的过程分为两步。第一步是只发送代码部分，即不包含实际数据的 SQL
语句。这就是准备步骤。从上面的代码片段中我们可以看到，实际数据被问号（?）完成这一步后，我们使用
bind param()
将数据发送到数据库。数据库只会将这一步发送的所有数据视为数据，而不再是代码。它会将数据与准备语句中相应的问号绑定。在
bind param() 方法中，第一个参数 "is "表示参数的类型：i "表示
<code>$id</code> 中的数据为整数类型，"s "表示
<code>$pwd</code>中的数据为字符串类型。</p>
<p><strong>任务</strong>：在本任务中，我们将使用准备语句机制来修复 SQL
注入漏洞。
为简单起见，我们在防御文件夹中创建了一个简化程序。我们将对该文件夹中的文件进行更改。如果将浏览器指向以下
URL，就会看到一个类似于网络应用程序登录页面的页面。该页面允许您查询员工信息，但您需要提供正确的用户名和密码。</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202312111514705.png" srcset="/img/loading.gif" lazyload
alt="image-20231211151044411" />
<figcaption aria-hidden="true">image-20231211151044411</figcaption>
</figure>
<p>在此页面输入的数据将被发送到服务器程序
getinfo.php，该程序会调用一个名为 unsafe.php 的程序。这个 PHP 程序中的
SQL 查询很容易受到 SQL 注入攻击。你的任务是使用准备语句修改 unsafe.php
中的 SQL 查询，这样程序就能抵御 SQL
注入攻击。在实验室设置文件夹中，unsafe.php 程序位于 image_www/Code/
defense
文件夹中。您可以直接在那里修改程序。完成后，需要重建并重新启动容器，否则更改不会生效。</p>
<p>你也可以在容器运行时修改该文件。在运行的容器中，unsafe.php 程序位于
/var/www/SQL_Injection/defense 中。这种方法的缺点是，为了保持 docker
镜像的小巧，我们只在容器内安装了一个名为 nano
的非常简单的文本编辑器。它应该足以满足简单编辑的需要。如果你不喜欢这个编辑器，可以使用
"apt install "在容器中安装你喜欢的命令行编辑器。例如，对于喜欢 vim
的人来说，可以执行以下操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ apt install -y vim<br></code></pre></td></tr></table></figure>
<p>容器关闭并销毁后，该安装文件将被丢弃。如果想永久安装，请将安装命令添加到
image_www 文件夹内的 Dockerfile 中。</p>
<p><strong>实验流程：</strong></p>
<ol type="1">
<li><p>修改代码：使用预处理机制，实现代码与数据分离。代码流程：先创建一个SQL查询的准备语句，绑定参数，"ss"表示两个参数都是字符串类型，执行SQL查询，将查询结果的各个列的值绑定到相应的变量，最后从数据库中获取一行查询结果，将其存储在绑定的变量中。
注：修改后需要重新构建容器镜像，启动容器。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// Function to create a sql connection.</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDB</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-variable">$dbhost</span>=<span class="hljs-string">&quot;10.9.0.6&quot;</span>;<br>  <span class="hljs-variable">$dbuser</span>=<span class="hljs-string">&quot;seed&quot;</span>;<br>  <span class="hljs-variable">$dbpass</span>=<span class="hljs-string">&quot;dees&quot;</span>;<br>  <span class="hljs-variable">$dbname</span>=<span class="hljs-string">&quot;sqllab_users&quot;</span>;<br><br>  <span class="hljs-comment">// Create a DB connection</span><br>  <span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbhost</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpass</span>, <span class="hljs-variable">$dbname</span>);<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Connection failed: &quot;</span> . <span class="hljs-variable">$conn</span>-&gt;connect_error . <span class="hljs-string">&quot;\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable">$conn</span>;<br>&#125;<br><br><span class="hljs-variable">$input_uname</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$input_pwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Password&#x27;</span>];<br><span class="hljs-variable">$hashed_pwd</span> = <span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$input_pwd</span>);<br><br><span class="hljs-comment">// create a connection</span><br><span class="hljs-variable">$conn</span> = <span class="hljs-title function_ invoke__">getDB</span>();<br><br><span class="hljs-comment">// do the query</span><br><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">&quot;SELECT id, name, eid, salary, ssn</span><br><span class="hljs-string">			FROM credential</span><br><span class="hljs-string">			WHERE name= ? and Password= ?&quot;</span>);<br><span class="hljs-comment">// Bind parameters to the query</span><br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">&quot;ss&quot;</span>, <span class="hljs-variable">$input_uname</span>, <span class="hljs-variable">$hashed_pwd</span>);<br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();<br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_result</span>(<span class="hljs-variable">$bind_id</span>, <span class="hljs-variable">$bind_name</span>, <span class="hljs-variable">$bind_eid</span>, <span class="hljs-variable">$bind_salary</span>, <span class="hljs-variable">$bind_ssn</span>);<br><span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">fetch</span>();<br><br><br><span class="hljs-variable">$id</span>     = <span class="hljs-variable">$bind_id</span>;<br><span class="hljs-variable">$name</span>   = <span class="hljs-variable">$bind_name</span>;<br><span class="hljs-variable">$eid</span>    = <span class="hljs-variable">$bind_eid</span>;<br><span class="hljs-variable">$salary</span> = <span class="hljs-variable">$bind_salary</span>;<br><span class="hljs-variable">$ssn</span>    = <span class="hljs-variable">$bind_ssn</span>;<br><br><br><span class="hljs-comment">// close the sql connection</span><br><span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li>
<li><p>正常查询个人信息，正常显示.</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810552.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172724532" />
<figcaption aria-hidden="true">image-20231107172724532</figcaption>
</figure></li>
<li><p>通过SQL注入方式访问admin个人信息，没有显示信息，证明预处理语句生效.</p>
<figure>
<img
src="https://raw.githubusercontent.com/kaikaikai7/BlogImage/main/img/202311071810553.png" srcset="/img/loading.gif" lazyload
alt="image-20231107172736731" />
<figcaption aria-hidden="true">image-20231107172736731</figcaption>
</figure></li>
<li><p>预处理语句防范SQL注入原理：将用户输入的数据与SQL查询分开，通过参数绑定（同时指定了参数类型）和自动转义来防止SQL注入攻击，同时提供了更好的性能和可维护性。</p></li>
</ol>
<p>参考教程：</p>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://seanxz401.github.io/2022/12/31/网络攻防-SQL注入/">网络攻防-SQL注入
- Sean's Blog (seanxz401.github.io)</a></li>
<li><a target="_blank" rel="noopener" href="https://gls.show/p/961c048e/">SEED-lab：SQL Injection
Attack Lab - 郭佳明的博客 (gls.show)</a></li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/SEED-LABS/" class="category-chain-item">SEED-LABS</a>
  
  
    <span>></span>
    
  <a href="/categories/SEED-LABS/Web-Security/" class="category-chain-item">Web Security</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SQL Injection Attack</div>
      <div>http://example.com/2023/11/07/SEED-LABS/Web Security/SQL Injection Attack/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>kaikaikai</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年11月7日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/11/11/%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1/Web%E6%B8%97%E9%80%8F/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8E%E8%A7%A3%E6%9E%90/" title="文件上传与解析">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">文件上传与解析</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/04/%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1/Web%E6%B8%97%E9%80%8F/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="命令执行">
                        <span class="hidden-mobile">命令执行</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
